<!DOCTYPE html>
<html>

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<script src="https://cdn.jsdelivr.net/npm/@gitgraph/js"></script>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

	<style>
		/**
     * The body tag of the graph generator is buggy and is hiding text 
     * following code patches this issue
     */
		li p {
			font: 10pt sans-serif;
			width: 70%;
			height: 120%;
			padding-top: 10px;
		}
    
	</style>

	<title>Git branching and merging, a visual story</title>
</head>

<body class="d-flex h-100 text-center text-white bg-dark">

	<div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
		<header class="mb-auto">
			<div>
				<h3 class="float-md-start mb-0">Git</h3>
				<nav class="nav nav-masthead justify-content-center float-md-end">
					<a class="nav-link active" aria-current="page" href="#">Home</a>
				</nav>
			</div>
		</header>

		<main class="container">
			<h1>Branching and merging, a visual story</h1>
			<p>
				<!-- DOM element in which we'll mount our graph -->
				<ol id="graph-list" class="list-group list-group-numbered">
				</ol>
			</p>
		</main>

		<footer class="mt-auto text-white-50">
			<p>Template based on <a href="https://getbootstrap.com/" class="text-white">Bootstrap</a>, by <a
					href="https://twitter.com/mdo" class="text-white">@mdo</a>.</p>
		</footer>
	</div>



	<!-- https://gitgraphjs.com/stories/?path=/story/gitgraph-js-1-basic-usage--default -->

	<!-- Use the `GitgraphJS` global variable to create your graph -->
	<script>
		// https://coolors.co/44af69-f8333c-fcab10-2b9eb3-dbd5b5
      
    const STYLE_BRANCH_LINE_WIDTH = 6;
    const STYLE_BRANCH_FEATURE_LINE_WIDTH = 5;
    
    const STYLE_BRANCH_DEV_LINE_WIDTH = 8;
    const STYLE_BRANCH_DEV_COLOR = "#F8333C";
    const STYLE_BRANCH_DEV_COLOR_TEXT = "#F8333C";
    const STYLE_BRANCH_DEV_COLOR_DOT = "#F8333C";
    
    const STYLE_BRANCH_SPRINT_LINE_WIDTH = 6;
    const STYLE_BRANCH_SPRINT_COLOR = "#AAFF00";
    const STYLE_BRANCH_SPRINT_COLOR_TEXT = "#AAFF00";
    const STYLE_BRANCH_SPRINT_COLOR_DOT = "#AAFF00";
    
    const STYLE_BRANCH_A_COLOR = "#FCAB10";
    const STYLE_BRANCH_A_COLOR_TEXT = "#FCAB10";
    const STYLE_BRANCH_A_COLOR_DOT = "#FCAB10";
    const STYLE_BRANCH_B_COLOR = "#2B9EB3";
    const STYLE_BRANCH_B_COLOR_TEXT = "#2B9EB3";
    const STYLE_BRANCH_B_COLOR_DOT = "#2B9EB3";
    const STYLE_BRANCH_C_COLOR = "#44AF69";
    const STYLE_BRANCH_C_COLOR_TEXT = "#44AF69";
    const STYLE_BRANCH_C_COLOR_DOT = "#44AF69";
    const STYLE_BRANCH_D_COLOR = "#DBD5B5";
    const STYLE_BRANCH_D_COLOR_TEXT = "#DBD5B5";
    const STYLE_BRANCH_D_COLOR_DOT = "#DBD5B5";

		const HASH_MERGE_SPRINT_ONE = "merge-sprint-one";
	  const HASH_MERGE_BRANCH_A = "merge-branch-a";
  
    // Get the graph container HTML element.
    const graphContainer = document.getElementById("graph-container");

    var author = {
        zeger: "Zeger Knops <zeger.knops@pon.com>",
        berry: "Berry Piest <berry.piest@pon.com>",
        jos: "Dennis Verweij <dennis.verweij@pon.com>",
    }

    for (let idx = 1; idx < 24; idx++) {
      let graphElement = document.createElement("div");

      graphElement.id = 'graph-container-' + idx;

      let textElement = graphElement.cloneNode();
      textElement.id = 'text-container-' + idx;

      let rootElement = document.createElement("li");
      rootElement.className = "list-group-item text-white bg-dark";
      rootElement.appendChild(graphElement);
      rootElement.appendChild(textElement);

      document.getElementById("graph-list").appendChild(rootElement);

      buildGraph(graphElement, textElement, idx);
    }

    function buildGraph(graphContainer, textContainer, step) {

      let customTemplate;
	    let gitgrap;
      let main;
      let dev;
      let sprintOne, sprintTwo;
      let branchA, branchB, branchC, branchD;
      const showBody = true;

      [
        (showBody) => {
          customTemplate = GitgraphJS.templateExtend(GitgraphJS.TemplateName.Metro, {
              commit: {
                  spacing: 35,
                  message: {
                      font: "10pt sans-serif",
                  },
                  dot: {
                      size: 10,
                  }
              },    
              branch: {
                  spacing: 35,
                  label: {
                      font: "10pt sans-serif",
                  },
              },
          });

          gitgraph = GitgraphJS.createGitgraph(graphContainer, {
            orientation: "vertical-reverse",
            branchLabelOnEveryCommit: true,
            //mode: GitgraphJS.Mode.Compact,
            template: customTemplate
          });

          main = gitgraph.branch("main");
          main.commit({
            subject: "Initial commit",
            body: showBody && `
              Inital commit created on the branch named "main"
            `,
            author: author.zeger,
          }); 

          textContainer.innerHTML = `
            Start of the project is here. Setup a git repository, check for license and
            add the developers.
          `

        }, 
		    (showBody) => {
          dev = main.branch({
            name: "dev",
            style: {
              color: STYLE_BRANCH_DEV_COLOR,
              lineWidth: STYLE_BRANCH_DEV_LINE_WIDTH
            }
          });

          dev.commit({
            subject: "Development branch",
						body: showBody && `
						  Create a seperate branch which will be used by the developers
						`,
            author: author.zeger,
            style: {
              color: STYLE_BRANCH_DEV_COLOR_TEXT,
              message: {
                color: STYLE_BRANCH_DEV_COLOR_TEXT,
              },
              dot: {
                color: STYLE_BRANCH_DEV_COLOR_DOT,
              }
            }
          });

					textContainer.innerHTML = `
            Setup the main branch, this will be the branch containing the lastest stable version
            of the software.
					`
        },
        (showBody) => {

          sprintOne = dev.branch({
            name: "Sprint 1",
            style: {
              color: STYLE_BRANCH_SPRINT_COLOR_TEXT,
                lineWidth: STYLE_BRANCH_SPRINT_LINE_WIDTH,
                message: {
                  color: STYLE_BRANCH_SPRINT_COLOR_TEXT,
                },
                dot: {
                  color: STYLE_BRANCH_SPRINT_COLOR_DOT,
                }
            }
          });

		      sprintOne.commit({
            subject: "Development branch",
            body: showBody && `
              Create a seperate branch for "Sprint 1"
            `,
           author: author.zeger,
          });

          textContainer.innerHTML = `

          `

        },
        (showBody) => {  

          sprintOne
            .commit({
              subject: "Fixed #JIRA-123",
              author: author.zeger,
            })
            .commit({
              subject: "Fixed #JIRA-124",
              author: author.berry,
            })
            .commit({
              subject: "Fixed #JIRA-125",
						  body: showBody && `
						    Developers working on the current sprint and commit their code
						  `,
              author: author.jos,
            })
          ;

        },
        (showBody) => {
          dev.merge({
            branch: sprintOne,
            commitOptions: {
              subject: "Merge sprint 1",
							body: showBody && `
							  Work is done on the sprint, merge it back to dev
							`,
              hash: HASH_MERGE_SPRINT_ONE,
              author: author.jos,
              style: {
                color: STYLE_BRANCH_DEV_COLOR_TEXT,
                message: {
                  color: STYLE_BRANCH_DEV_COLOR_TEXT,
                },
                dot: {
                  color: STYLE_BRANCH_DEV_COLOR_DOT,
                }
              }
            }
          });
        },
		    (showBody) => {

          mergeResult = main.merge({
            branch: dev,
            commitOptions: {
              subject: "Merge dev to main",
              body: showBody && `
                Dev has been tested and approved, merge it to main.
                Tag the main branch with the new version of the software
              `,
              author: author.jos,
            }
          }).tag("v1.0.0");
          
        },
        (showBody) => {
          /**
          * Second sprint
          */
          sprintTwo = gitgraph.branch({
            name: "Sprint 2",
            from: HASH_MERGE_SPRINT_ONE,
            style: {
              color: STYLE_BRANCH_SPRINT_COLOR_TEXT,
              lineWidth: STYLE_BRANCH_SPRINT_LINE_WIDTH,
              message: {
                color: STYLE_BRANCH_SPRINT_COLOR_TEXT,
              },
              dot: {
                color: STYLE_BRANCH_SPRINT_COLOR_DOT, 
              }
            }
          });

          sprintTwo.commit({
            subject: "Sprint 2 branch",
            body: showBody && `
              Create the branch for the second sprint
            `,
            author: author.zeger,
          });

        },
        (showBody) => {

          branchA = sprintTwo.branch({
            name: "Feature #JIRA-223", from: HASH_MERGE_SPRINT_ONE,
            style: { color: STYLE_BRANCH_A_COLOR, lineWidth: STYLE_BRANCH_FEATURE_LINE_WIDTH },
          });

          // Dev cycle 1
          branchA
            .commit({
              subject: "+wrote some code #JIRA-223",
              body: showBody && `
                Separate branch for sprint 2 to work on a specfic feature
              `,
              author: author.zeger,
              style: {
                color: STYLE_BRANCH_A_COLOR_TEXT,
                message: {
                  color: STYLE_BRANCH_A_COLOR_TEXT,
                },
                dot: {
                  color: STYLE_BRANCH_A_COLOR_DOT,
                }
              }
            });
        },
        (showBody) => {

          branchB = sprintTwo.branch({
            name: "Bugfix #JIRA-224", from: HASH_MERGE_SPRINT_ONE,
            style: { color: STYLE_BRANCH_B_COLOR, lineWidth: STYLE_BRANCH_FEATURE_LINE_WIDTH },
          });

          branchB
            .commit({
              subject: "+wrote some code #JIRA-224",
							body: showBody && `
						  	Separate branch for sprint 2 to fix a bug
							`,
              author: author.berry,
              style: {
                color: STYLE_BRANCH_B_COLOR_TEXT,
                message: {
                  color: STYLE_BRANCH_B_COLOR_TEXT,
                },
                dot: {
                  color: STYLE_BRANCH_B_COLOR_DOT,
                }
              }
            });
          
				},
				(showBody) => {

          branchC = sprintTwo.branch({
            name: "Task #JIRA-225", from: HASH_MERGE_SPRINT_ONE,
            style: { color: STYLE_BRANCH_C_COLOR, lineWidth: STYLE_BRANCH_FEATURE_LINE_WIDTH },
          });

          branchC
            .commit({
              subject: "+wrote some code #JIRA-225",
              body: showBody && `
                Separate branch for sprint 2 to work on a task
              `,
              author: author.jos,
              style: {
                color: STYLE_BRANCH_C_COLOR_TEXT,
                message: {
                  color: STYLE_BRANCH_C_COLOR_TEXT,
                },
                dot: {
                  color: STYLE_BRANCH_C_COLOR_DOT,
                }
              }
            });

          }, 
          (showBody) => { // Step 11

            // Dev cycle 2
            branchA
              .commit({
                subject: "*fixed some code #JIRA-223",
                author: author.zeger,
                style: {
                    color: STYLE_BRANCH_A_COLOR_TEXT,
                    message: {
                        color: STYLE_BRANCH_A_COLOR_TEXT,
                    },
                    dot: {
                        color: STYLE_BRANCH_A_COLOR_DOT,
                    }
                }
              });       

            branchB
              .commit({
                subject: "*fixed some code #JIRA-224",
                author: author.berry,
                style: {
                    color: STYLE_BRANCH_B_COLOR_TEXT,
                    message: {
                        color: STYLE_BRANCH_B_COLOR_TEXT,
                    },
                    dot: {
                        color: STYLE_BRANCH_B_COLOR_DOT,
                    }
                }
              }); 

            branchC
              .commit({
                subject: "*fixed some code #JIRA-225",
                author: author.jos,
                body: showBody && `
                  Developers working on their tasks and commiting the code
                `,
                style: {
                    color: STYLE_BRANCH_C_COLOR_TEXT,
                    message: {
                        color: STYLE_BRANCH_C_COLOR_TEXT,
                    },
                    dot: {
                        color: STYLE_BRANCH_C_COLOR_DOT,
                    }
                }
              });        

          },
          (showBody) => { // Step 12

            sprintTwo.merge({
                branch: branchC,
                commitOptions: {
                    subject: "Merge 'Task #JIRA-225' to sprint 2 branch",
                    author: author.jos,
                    body: showBody && `
                      Task done, code is merged back to sprint branch
                    `,
                    style: {
                        color: STYLE_BRANCH_SPRINT_COLOR_TEXT,
                        message: {
                            color: STYLE_BRANCH_SPRINT_COLOR_TEXT,
                        },
                        dot: {
                            color: STYLE_BRANCH_SPRINT_COLOR_DOT,
                        }
                    }
                }
            });      

          },
          (showBody) => { // Step 13

            branchA.merge({
                branch: sprintTwo,
                commitOptions: {
                    subject: "Merge sprint 2",
                    author: author.zeger,
                    style: {
                        color: STYLE_BRANCH_A_COLOR_TEXT,
                        message: {
                            color: STYLE_BRANCH_A_COLOR_TEXT,
                        },
                        dot: {
                            color: STYLE_BRANCH_A_COLOR_DOT,
                        }
                    }
                }
            });       

            branchB.merge({
                branch: sprintTwo,
                commitOptions: {
                    subject: "Merge sprint 2",
                    author: author.zeger,
                    body: showBody && `
                      Merge the changes back from the sprint branch to the issues branches
                    `,
                    style: {
                        color: STYLE_BRANCH_B_COLOR_TEXT,
                        message: {
                            color: STYLE_BRANCH_B_COLOR_TEXT,
                        },
                        dot: {
                            color: STYLE_BRANCH_B_COLOR_DOT,
                        }
                    }
                }
            });  

          },
          (showBody) => { // Step 14

            // Hotfix
            dev
              .commit({
                subject: "*hotfix",
                author: author.jos,
                body: showBody && `
                  Problem on live environment, hotfix build and tested on dev branch
                `,
                style: {
                    color: STYLE_BRANCH_DEV_COLOR_TEXT,
                    message: {
                        color: STYLE_BRANCH_DEV_COLOR_TEXT,
                    },
                    dot: {
                        color: STYLE_BRANCH_DEV_COLOR_DOT,
                    }            
                }
              }); 

          },
          (showBody) => { // Step 15

            main.merge({
                branch: dev,
                commitOptions: {
                    subject: "Merge hotfix to main branch",
                    author: author.jos,
                    body: showBody && `
                      Merge hotfix to main branch and tag with new version
                    `,
                }        
            }).tag("v1.1.0");    

          },
          (showBody) => { // Step 16

            sprintTwo.merge({
                branch: dev,
                commitOptions: {
                    subject: "Merge hotfix to sprint 2 branch",
                    author: author.jos,
                    body: showBody && `
                      Merge hotfix to sprint branch
                    `,
                    style: {
                        color: STYLE_BRANCH_SPRINT_COLOR_TEXT,
                        message: {
                            color: STYLE_BRANCH_SPRINT_COLOR_TEXT,
                        },
                        dot: {
                            color: STYLE_BRANCH_SPRINT_COLOR_DOT,
                        }            
                    }
                }        
            });

          },
          (showBody) => { // Step 17

            branchA.merge({
                branch: sprintTwo,
                commitOptions: {
                    subject: "Merge hotfix to feature branch",
                    author: author.zeger,
                    style: {
                        color: STYLE_BRANCH_A_COLOR_TEXT,
                        message: {
                            color: STYLE_BRANCH_A_COLOR_TEXT,
                        },
                        dot: {
                            color: STYLE_BRANCH_A_COLOR_DOT,
                        }            
                    }
                }        
            });    

            branchB.merge({
                branch: sprintTwo,
                commitOptions: {
                    subject: "Merge hotfix to feature branch",
                    author: author.berry,
                    style: {
                        color: STYLE_BRANCH_B_COLOR_TEXT,
                        message: {
                            color: STYLE_BRANCH_B_COLOR_TEXT,
                        },
                        dot: {
                            color: STYLE_BRANCH_B_COLOR_DOT,
                        }            
                    }
                }        
            });    

            branchC.merge({
                branch: sprintTwo,
                commitOptions: {
                    subject: "Merge hotfix to feature branch",
                    author: author.jos,
                    body: showBody && `
										  Feature branches also require the hotfix
										`,
                    style: {
                        color: STYLE_BRANCH_C_COLOR_TEXT,
                        message: {
                            color: STYLE_BRANCH_C_COLOR_TEXT,
                        },
                        dot: {
                            color: STYLE_BRANCH_C_COLOR_DOT,
                        }            
                    }
                }        
            });    

          },
          (showBody) => { // Step 18

            branchA
              .commit({
                subject: "-removed some code #JIRA-223",
                author: author.zeger,
                style: {
                    color: STYLE_BRANCH_A_COLOR_TEXT,
                    message: {
                        color: STYLE_BRANCH_A_COLOR_TEXT,
                    },
                    dot: {
                        color: STYLE_BRANCH_A_COLOR_DOT,
                    }
                }
              });       

            
            sprintTwo.merge({
                branch: branchA,
                commitOptions: {
                    subject: "Merge 'Feature #JIRA-223' to sprint 2 branch",
                    author: author.zeger,
										body: showBody && `
                      Issue resolved and coding done, merge changes to sprint branch
										`,
                    hash: HASH_MERGE_BRANCH_A,
                    style: {
                        color: STYLE_BRANCH_SPRINT_COLOR_TEXT,
                        message: {
                            color: STYLE_BRANCH_SPRINT_COLOR_TEXT,
                        },
                        dot: {
                            color: STYLE_BRANCH_SPRINT_COLOR_DOT,
                        }            
                    }
                }
            });   

          },
          (showBody) => { // Step 19
      
            branchD = gitgraph.branch({
              name: "Feature #JIRA-228", from: HASH_MERGE_BRANCH_A,
              style: { color: STYLE_BRANCH_D_COLOR, lineWidth: STYLE_BRANCH_FEATURE_LINE_WIDTH },
            });

            branchD
              .commit({
                subject: "-removed some code #JIRA-228",
                author: author.zeger,
                body: showBody && `
                  New issue picked up, branch from sprint branch to start coding
                `,
                style: {
                    color: STYLE_BRANCH_D_COLOR_TEXT,
                    message: {
                        color: STYLE_BRANCH_D_COLOR_TEXT,
                    },
                    dot: {
                        color: STYLE_BRANCH_D_COLOR_DOT,
                    }
                }
              });    
    
          },
          (showBody) => { // Step 20

            branchB
              .commit({
                subject: "-removed some code #JIRA-224",
                author: author.berry,
                style: {
                    color: STYLE_BRANCH_B_COLOR_TEXT,
                    message: {
                        color: STYLE_BRANCH_B_COLOR_TEXT,
                    },
                    dot: {
                        color: STYLE_BRANCH_B_COLOR_DOT,
                    }
                }
              });

            branchC
              .commit({
                subject: "-removed some code #JIRA-225224",
                author: author.jos,
                style: {
                    color: STYLE_BRANCH_C_COLOR_TEXT,
                    message: {
                        color: STYLE_BRANCH_C_COLOR_TEXT,
                    },
                    dot: {
                        color: STYLE_BRANCH_C_COLOR_DOT,
                    }
                }
              });       

            branchD
              .commit({
                subject: "*bugfix #JIRA-228",
                author: author.zeger,
								body: showBody && `
								  Developers working on their issues and committing to the issue branch
								`,
                style: {
                    color: STYLE_BRANCH_D_COLOR_TEXT,
                    message: {
                        color: STYLE_BRANCH_D_COLOR_TEXT,
                    },
                    dot: {
                        color: STYLE_BRANCH_D_COLOR_DOT,
                    }
                }
              }); 

          },
          (showBody) => { // Step 21

            sprintTwo.merge({
                branch: branchB,
                commitOptions: {
                    subject: "Merge 'Bugfix #JIRA-224' to sprint 2 branch",
                    author: author.berry,
                    style: {
                        color: STYLE_BRANCH_SPRINT_COLOR_TEXT,
                        message: {
                            color: STYLE_BRANCH_SPRINT_COLOR_TEXT,
                        },
                        dot: {
                            color: STYLE_BRANCH_SPRINT_COLOR_DOT,
                        }            
                    }
                }
            });    

            sprintTwo.merge({
                branch: branchC,
                commitOptions: {
                    subject: "Merge 'Task #JIRA-225' to sprint 2 branch",
                    author: author.jos,
                    style: {
                        color: STYLE_BRANCH_SPRINT_COLOR_TEXT,
                        message: {
                            color: STYLE_BRANCH_SPRINT_COLOR_TEXT,
                        },
                        dot: {
                            color: STYLE_BRANCH_SPRINT_COLOR_DOT,
                        }            
                    }
                }
            });    

            sprintTwo.merge({
                branch: branchD,
                commitOptions: {
                    subject: "Merge 'Task #JIRA-228' to sprint 2 branch",
                    author: author.jos,
                    body: showBody && `
                      All issues coded, code is merged back into the sprint branch
                    `,
                    style: {
                        color: STYLE_BRANCH_SPRINT_COLOR_TEXT,
                        message: {
                            color: STYLE_BRANCH_SPRINT_COLOR_TEXT,
                        },
                        dot: {
                            color: STYLE_BRANCH_SPRINT_COLOR_DOT,
                        }            
                    }
                }
            });     
          
          },
          (showBody) => { // Step 22
          
            dev.merge({
                branch: sprintTwo, 
                commitOptions: {
                    subject: "Merge sprint 2",
                    author: author.jos,
										body: showBody && `
                        Test the sprint branch and merge to dev
										`,
                    style: {
                        color: STYLE_BRANCH_DEV_COLOR_TEXT,
                        message: {
                            color: STYLE_BRANCH_DEV_COLOR_TEXT,
                        },
                        dot: {
                            color: STYLE_BRANCH_DEV_COLOR_DOT,
                        }            
                    }
                }
            });

          },
          (showBody) => { // Step 23

            main.merge({
                branch: dev, 
                commitOptions: {
                    subject: "Merge dev to main",
                    author: author.jos,
                    body: showBody && `
                      Merge dev to main and tag with new version
                    `,
                }
            }).tag("v2.0.0");  

          },
          (showBody) => { // Step 24
          },
          (showBody) => { // Step 25 
          },
          (showBody) => { // Step 26
          }
      ].slice(0, step).map((x, index) => x(index == step - 1));

   

  
    }
    
	</script>
</body>

</html>
